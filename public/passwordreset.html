<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <input placeholder="Enter the new password" id="pw">
    <input placeholder="Confirm the new password" id="confpw">
    <button onclick="submitButton()">Submit</button>
    <script>

        function validatePassword(pass1, pass2) {
            if (pass1 === pass2)
                return true
            return false
        }

        function submitButton() {

            let pass1 = document.getElementById('pw').value
            let pass2 = document.getElementById('confpw').value
            if (validatePassword(pass1, pass2)) {
                let params = (new URL(document.location)).searchParams;
                let token = params.get('token')
                let fetchUrl = 'http://127.0.0.1:3000/resetPasswordFinal' + '?token=' + token
                console.log(fetchUrl)


                var details = {
                    'password': document.getElementById('pw').value,
                    'confPassword': document.getElementById('confpw').value,
                };

                var formBody = [];
                for (var property in details) {
                    var encodedKey = encodeURIComponent(property);
                    var encodedValue = encodeURIComponent(details[property]);
                    formBody.push(encodedKey + "=" + encodedValue);
                }
                formBody = formBody.join("&");

                fetch(fetchUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                    },
                    body: formBody
                })
            }
            else {
                console.log("Passwords dont match !")
                document.getElementById('pw').value = ""
                document.getElementById('confpw').value = ""
            }
        }
    </script>
</body>

</html>